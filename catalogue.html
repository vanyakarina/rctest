<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalogue Input</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        nav { /* your styles for navigation */ }
        .content { /* your styles for content */ }
        table { /* your styles for table */ }
        .songwriters-list { margin-top: 20px; }
        .songwriters-list label { display: block; margin-top: 5px; }
        .edit-button { margin-left: 10px; }
    </style>
</head>
<body>
    <nav>
        <a href="index.html">Home</a>
        <a href="songwriters.html">Songwriters Input</a>
        <a href="catalogue.html">Catalogue Input</a>
        <a href="royalty.html">Royalty Calculation</a>
        <a href="royalty_report.html">Royalty Report</a>
    </nav>

    <div class="content">
        <h1>Catalogue Input</h1>
        <form id="catalogueForm">
            <h2>Input Song Details</h2>
            <label for="songTitle">Song Title:</label>
            <input type="text" id="songTitle" required>

            <label for="recordLabel">Record Label:</label>
            <input type="text" id="recordLabel" required>

            <label for="singer">Singer:</label>
            <input type="text" id="singer" required>

            <label for="releaseDate">Release Date:</label>
            <input type="date" id="releaseDate" required>

            <label for="distributor">Distributor:</label>
            <input type="text" id="distributor" required>

            <label for="isrc">ISRC:</label>
            <input type="text" id="isrc" required>

            <div id="songwritersSection">
                <h3>Songwriters</h3>
                <div id="songwritersList" class="songwriters-list">
                    <!-- Songwriter inputs will be added here -->
                </div>
                <button type="button" onclick="addSongwriter()">Add Songwriter</button>
            </div>

            <button type="button" onclick="addSongToCatalogue()">Add Song to Catalogue</button>
        </form>

        <h2>Catalogue List</h2>
        <table id="catalogueTable">
            <thead>
                <tr>
                    <th>Song Title</th>
                    <th>Record Label</th>
                    <th>Singer</th>
                    <th>Release Date</th>
                    <th>Distributor</th>
                    <th>ISRC</th>
                    <th>Songwriters</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Catalogue data will be added here -->
            </tbody>
        </table>
    </div>

    <script>
        let catalogue = JSON.parse(localStorage.getItem('catalogue')) || [];
        let songwriters = JSON.parse(localStorage.getItem('songwriters')) || [];

        function addSongwriter() {
            const songwritersList = document.getElementById('songwritersList');
            const writerCount = songwritersList.children.length;
            const writerDiv = document.createElement('div');

            const nameLabel = document.createElement('label');
            nameLabel.textContent = `Songwriter ${writerCount + 1}:`;
            const nameInput = document.createElement('select');
            nameInput.id = `songwriterName_${writerCount}`;
            songwriters.forEach(sw => {
                const option = document.createElement('option');
                option.value = sw.name;
                option.textContent = sw.name;
                nameInput.appendChild(option);
            });
            const addUnsignedOption = document.createElement('option');
            addUnsignedOption.value = 'Unsigned';
            addUnsignedOption.textContent = 'Add New Songwriter';
            nameInput.appendChild(addUnsignedOption);
            nameInput.addEventListener('change', function() {
                if (this.value === 'Unsigned') {
                    const newName = prompt('Enter the name of the unsigned songwriter:');
                    if (newName) {
                        const newOption = document.createElement('option');
                        newOption.value = newName;
                        newOption.textContent = newName;
                        nameInput.insertBefore(newOption, addUnsignedOption);
                        nameInput.value = newName;
                    }
                }
            });

            const roleLabel = document.createElement('label');
            roleLabel.textContent = 'Role (A/C/CA):';
            const roleInput = document.createElement('input');
            roleInput.type = 'text';
            roleInput.id = `role_${writerCount}`;

            const shareLabel = document.createElement('label');
            shareLabel.textContent = 'Share (%):';
            const shareInput = document.createElement('input');
            shareInput.type = 'number';
            shareInput.id = `share_${writerCount}`;

            writerDiv.appendChild(nameLabel);
            writerDiv.appendChild(nameInput);
            writerDiv.appendChild(roleLabel);
            writerDiv.appendChild(roleInput);
            writerDiv.appendChild(shareLabel);
            writerDiv.appendChild(shareInput);

            songwritersList.appendChild(writerDiv);
        }

        function addSongToCatalogue() {
            const songTitle = document.getElementById('songTitle').value;
            const recordLabel = document.getElementById('recordLabel').value;
            const singer = document.getElementById('singer').value;
            const releaseDate = document.getElementById('releaseDate').value;
            const distributor = document.getElementById('distributor').value;
            const isrc = document.getElementById('isrc').value;

            const songwriters = [];
            document.querySelectorAll('#songwritersList > div').forEach(div => {
                const name = div.querySelector('select').value;
                const role = div.querySelector('input[type="text"]').value;
                const share = parseFloat(div.querySelector('input[type="number"]').value) || 0;
                songwriters.push({ name, role, share });
            });

            const song = {
                title: songTitle,
                recordLabel,
                singer,
                releaseDate,
                distributor,
                isrc,
                songwriters
            };

            catalogue.push(song);
            localStorage.setItem('catalogue', JSON.stringify(catalogue));
            renderCatalogue();
        }

        function renderCatalogue() {
            const tableBody = document.getElementById('catalogueTable').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';

            catalogue.forEach((song, index) => {
                const row = tableBody.insertRow();
                row.insertCell(0).textContent = song.title;
                row.insertCell(1).textContent = song.recordLabel;
                row.insertCell(2).textContent = song.singer;
                row.insertCell(3).textContent = song.releaseDate;
                row.insertCell(4).textContent = song.distributor;
                row.insertCell(5).textContent = song.isrc;

                const songwritersCell = row.insertCell(6);
                songwritersCell.textContent = song.songwriters.map(sw => `${sw.name} (${sw.role}, ${sw.share}%)`).join(', ');

                const actionsCell = row.insertCell(7);
                const editButton = document.createElement('button');
                editButton.textContent = 'Edit';
                editButton.className = 'edit-button';
                editButton.onclick = () => editSong(index);
                actionsCell.appendChild(editButton);
            });
        }

        function editSong(index) {
            const song = catalogue[index];
            document.getElementById('songTitle').value = song.title;
            document.getElementById('recordLabel').value = song.recordLabel;
            document.getElementById('singer').value = song.singer;
            document.getElementById('releaseDate').value = song.releaseDate;
            document.getElementById('distributor').value = song.distributor;
            document.getElementById('isrc').value = song.isrc;

            const songwritersSection = document.getElementById('songwritersList');
            songwritersSection.innerHTML = '';
            song.songwriters.forEach((sw, i) => {
                const writerDiv = document.createElement('div');

                const nameLabel = document.createElement('label');
                nameLabel.textContent = `Songwriter ${i + 1}:`;
                const nameInput = document.createElement('select');
                nameInput.id = `songwriterName_${i}`;
                const option = document.createElement('option');
                option.value = sw.name;
                option.textContent = sw.name;
                nameInput.appendChild(option);
                nameInput.addEventListener('change', function() {
                    if (this.value === 'Unsigned') {
                        const newName = prompt('Enter the name of the unsigned songwriter:');
                        if (newName) {
                            const newOption = document.createElement('option');
                            newOption.value = newName;
                            newOption.textContent = newName;
                            nameInput.insertBefore(newOption, this.options[0]);
                            nameInput.value = newName;
                        }
                    }
                });

                const roleLabel = document.createElement('label');
                roleLabel.textContent = 'Role (A/C/CA):';
                const roleInput = document.createElement('input');
                roleInput.type = 'text';
                roleInput.id = `role_${i}`;
                roleInput.value = sw.role;

                const shareLabel = document.createElement('label');
                shareLabel.textContent = 'Share (%):';
                const shareInput = document.createElement('input');
                shareInput.type = 'number';
                shareInput.id = `share_${i}`;
                shareInput.value = sw.share;

                writerDiv.appendChild(nameLabel);
                writerDiv.appendChild(nameInput);
                writerDiv.appendChild(roleLabel);
                writerDiv.appendChild(roleInput);
                writerDiv.appendChild(shareLabel);
                writerDiv.appendChild(shareInput);

                songwritersSection.appendChild(writerDiv);
            });

            // Replace Add Song to Catalogue button with Update Song button
            const addButton = document.querySelector('button[onclick="addSongToCatalogue()"]');
            addButton.textContent = 'Update Song';
            addButton.setAttribute('onclick', `updateSong(${index})`);
        }

        function updateSong(index) {
            const songTitle = document.getElementById('songTitle').value;
            const recordLabel = document.getElementById('recordLabel').value;
            const singer = document.getElementById('singer').value;
            const releaseDate = document.getElementById('releaseDate').value;
            const distributor = document.getElementById('distributor').value;
            const isrc = document.getElementById('isrc').value;

            const songwriters = [];
            document.querySelectorAll('#songwritersList > div').forEach(div => {
                const name = div.querySelector('select').value;
                const role = div.querySelector('input[type="text"]').value;
                const share = parseFloat(div.querySelector('input[type="number"]').value) || 0;
                songwriters.push({ name, role, share });
            });

            catalogue[index] = {
                title: songTitle,
                recordLabel,
                singer,
                releaseDate,
                distributor,
                isrc,
                songwriters
            };

            localStorage.setItem('catalogue', JSON.stringify(catalogue));
            renderCatalogue();
        }

        window.onload = renderCatalogue;
    </script>
</body>
</html>
